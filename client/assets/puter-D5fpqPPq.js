import{z as y}from"./chunk-QMGIS6GS-DX0VMMAr.js";const P=a=>{let s;const n=new Set,i=(o,g)=>{const c=typeof o=="function"?o(s):o;if(!Object.is(c,s)){const f=s;s=g??(typeof c!="object"||c===null)?c:Object.assign({},s,c),n.forEach(S=>S(s,f))}},l=()=>s,h={setState:i,getState:l,getInitialState:()=>d,subscribe:o=>(n.add(o),()=>n.delete(o))},d=s=a(i,l,h);return h},L=a=>a?P(a):P,x=a=>a;function F(a,s=x){const n=y.useSyncExternalStore(a.subscribe,()=>s(a.getState()),()=>s(a.getInitialState()));return y.useDebugValue(n),n}const A=a=>{const s=L(a),n=i=>F(s,i);return Object.assign(n,s),n},K=a=>a?A(a):A,u=()=>typeof window<"u"&&window.puter?window.puter:null,V=K((a,s)=>{const n=t=>{a({error:t,isLoading:!1,auth:{user:null,isAuthenticated:!1,signIn:s().auth.signIn,signOut:s().auth.signOut,refreshUser:s().auth.refreshUser,checkAuthStatus:s().auth.checkAuthStatus,getUser:s().auth.getUser}})},i=async()=>{console.log("checkAuthStatus: Starting auth check...");const t=u();if(!t)return console.error("checkAuthStatus: Puter.js not available"),n("Puter.js not available"),!1;a({isLoading:!0,error:null});try{console.log("checkAuthStatus: Checking if user is signed in...");const e=await t.auth.isSignedIn();if(console.log("checkAuthStatus: isSignedIn result:",e),e){console.log("checkAuthStatus: User is signed in, getting user data...");const r=await t.auth.getUser();return console.log("checkAuthStatus: User data:",r),a({auth:{user:r,isAuthenticated:!0,signIn:s().auth.signIn,signOut:s().auth.signOut,refreshUser:s().auth.refreshUser,checkAuthStatus:s().auth.checkAuthStatus,getUser:()=>r},isLoading:!1}),console.log("checkAuthStatus: Auth state updated - authenticated"),!0}else return console.log("checkAuthStatus: User is not signed in"),a({auth:{user:null,isAuthenticated:!1,signIn:s().auth.signIn,signOut:s().auth.signOut,refreshUser:s().auth.refreshUser,checkAuthStatus:s().auth.checkAuthStatus,getUser:()=>null},isLoading:!1}),console.log("checkAuthStatus: Auth state updated - not authenticated"),!1}catch(e){console.error("checkAuthStatus: Error during auth check:",e);const r=e instanceof Error?e.message:"Failed to check auth status";return n(r),!1}},l=async()=>{console.log("signIn: Starting sign in process...");const t=u();if(!t){console.error("signIn: Puter.js not available"),n("Puter.js not available");return}a({isLoading:!0,error:null});try{console.log("signIn: Calling puter.auth.signIn()..."),await t.auth.signIn(),console.log("signIn: Sign in successful, checking auth status..."),await i()}catch(e){console.error("signIn: Error during sign in:",e);const r=e instanceof Error?e.message:"Sign in failed";n(r)}},b=async()=>{const t=u();if(!t){n("Puter.js not available");return}a({isLoading:!0,error:null});try{await t.auth.signOut(),a({auth:{user:null,isAuthenticated:!1,signIn:s().auth.signIn,signOut:s().auth.signOut,refreshUser:s().auth.refreshUser,checkAuthStatus:s().auth.checkAuthStatus,getUser:()=>null},isLoading:!1})}catch(e){const r=e instanceof Error?e.message:"Sign out failed";n(r)}},k=async()=>{const t=u();if(!t){n("Puter.js not available");return}a({isLoading:!0,error:null});try{const e=await t.auth.getUser();a({auth:{user:e,isAuthenticated:!0,signIn:s().auth.signIn,signOut:s().auth.signOut,refreshUser:s().auth.refreshUser,checkAuthStatus:s().auth.checkAuthStatus,getUser:()=>e},isLoading:!1})}catch(e){const r=e instanceof Error?e.message:"Failed to refresh user";n(r)}},h=()=>{if(console.log("Puter init: Starting initialization..."),u()){console.log("Puter init: Puter.js already available"),a({puterReady:!0}),i();return}console.log("Puter init: Puter.js not available, starting polling...");const e=setInterval(()=>{u()&&(console.log("Puter init: Puter.js loaded successfully"),clearInterval(e),a({puterReady:!0}),i())},100);setTimeout(()=>{clearInterval(e),u()||(console.error("Puter init: Failed to load Puter.js within 10 seconds"),n("Puter.js failed to load within 10 seconds"))},1e4)},d=async(t,e)=>{const r=u();if(!r){n("Puter.js not available");return}return r.fs.write(t,e)},o=async t=>{const e=u();if(!e){n("Puter.js not available");return}return e.fs.readdir(t)},g=async t=>{const e=u();if(!e){n("Puter.js not available");return}return e.fs.read(t)},c=async t=>{const e=u();if(!e){n("Puter.js not available");return}return e.fs.upload(t)},f=async t=>{const e=u();if(!e){n("Puter.js not available");return}return e.fs.delete(t)},S=async(t,e,r,p)=>{const v=u();if(!v){n("Puter.js not available");return}return v.ai.chat(t,e,r,p)},I=async(t,e)=>{const r=u();if(!r){n("Puter.js not available");return}return r.ai.chat([{role:"user",content:[{type:"file",puter_path:t},{type:"text",text:e}]}],{model:"claude-3-7-sonnet"})},j=async(t,e)=>{const r=u();if(!r){n("Puter.js not available");return}return r.ai.img2txt(t,e)},U=async t=>{const e=u();if(!e){n("Puter.js not available");return}return e.kv.get(t)},w=async(t,e)=>{const r=u();if(!r){n("Puter.js not available");return}return r.kv.set(t,e)},m=async t=>{const e=u();if(!e){n("Puter.js not available");return}return e.kv.delete(t)},O=async(t,e)=>{const r=u();if(!r){n("Puter.js not available");return}return e===void 0&&(e=!1),r.kv.list(t,e)},E=async()=>{const t=u();if(!t){n("Puter.js not available");return}return t.kv.flush()};return{isLoading:!0,error:null,puterReady:!1,auth:{user:null,isAuthenticated:!1,signIn:l,signOut:b,refreshUser:k,checkAuthStatus:i,getUser:()=>s().auth.user},fs:{write:(t,e)=>d(t,e),read:t=>g(t),readDir:t=>o(t),upload:t=>c(t),delete:t=>f(t)},ai:{chat:(t,e,r,p)=>S(t,e,r,p),feedback:(t,e)=>I(t,e),img2txt:(t,e)=>j(t,e)},kv:{get:t=>U(t),set:(t,e)=>w(t,e),delete:t=>m(t),list:(t,e)=>O(t,e),flush:()=>E()},init:h,clearError:()=>a({error:null})}});export{V as u};
